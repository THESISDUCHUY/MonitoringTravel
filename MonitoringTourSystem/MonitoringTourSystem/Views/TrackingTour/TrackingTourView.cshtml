@model MonitoringTourSystem.ViewModel.HomeViewModel
@{
    ViewBag.Title = "Home Page";
}
<div id="main-content" style="background-color: #1FB5AD; height: 100%;">
    <div class="wrapper" style="background-color: white; height: 87.5%; padding-top: 15px;">
        <div class='row' style="height: 100%; width: 100%; margin: 0px;">
            <div class="col-sm-3" style="height:100%; ">
                <div style="width:100%; background-color: white; height: 100%; border-radius: 3px; border: 1px solid #EAEBED">
                    <div style="height: 7%;  border-top-left-radius: 5px; border-top-right-radius: 5px;">
                        <p style="padding-top: 16px; margin-left: 12px; font-size: 16px;">Tìm kiếm nhanh</p>
                    </div>
                    <div style="height: 1%;">

                    </div>
                    <div class="dropdown" style="height: 7%;  padding-left: 4px; padding-right: 4px;">
                        <button class="btn" style="width: 100% ;" type="button" data-toggle="dropdown">
                            <span>Tìm Theo Tỉnh Thành</span>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" style="width: 97.5%; margin-top: -1px; margin-left: 4px; ">
                            <li><a href="#">Hà Nội</a></li>
                            <li><a href="#">Đà Nẵng</a></li>
                            <li><a href="#">Hồ Chí Minh</a></li>
                            <li><a href="#">Đà Lạt</a></li>
                            <li><a href="#">Quảng Bình</a></li>
                            <li><a href="#">Quảng Nam</a></li>
                            <li><a href="#">Cần Thơ</a></li>
                            <li><a href="#">Phú Quốc</a></li>

                        </ul>
                    </div>
                    <div style="height: 1%;">

                    </div>
                    <div style="height: 7%; padding-left: 4px; padding-right: 4px;">
                        <div id="searchform">
                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Tìm kiếm tour theo mã..." id="nametour" name="query" value="">
                                <div class="input-group-btn">
                                    <button type="submit" id="Search" class="btn">
                                        <i class="fa fa-search" style="color: gray" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="group-list-tour" style="height: 77%;">
                        <div id="list-tour" style="height: 100% ; overflow-y: hidden">
                            @*@{
                                Html.RenderPartial("ListTourGuide", Model);
                            }*@
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-9" style="height: 100%;  ">
                <div style="height: 10%; background-color: transparent;">

                    <div style="height: 98%; width: 47.5%; background-color: #FAFAFA;  border-radius: 1px;   border: 1px solid #EAEBED; float: left;">
                        <p style="padding-top: 14px; margin-left: 12px; font-size: 20px;">TRACKING TOURGUIDE</p>
                    </div>

                    <div id="message-content" onclick="messageClick();" style="height: 98%; width: 15%">
                        <a href="#">
                            <div style="height: 100%; float: left; width: 30%; display:table-cell; vertical-align:central; text-align:center; padding-top: 18px;">
                                <img alt="" src="~/Content/Images/ic_message.png" height="20" width="20">
                            </div>
                            <div style="height: 100%; float: left; width: 70%;">
                                <p style="color: white; vertical-align:top; font-size: 20px; padding-left: 55px;">12</p>
                                <p style="color: white; font-size: 12px; padding-left: 5px;">Tin nhắn mới</p>
                            </div>
                        </a>
                    </div>
                    <div id="map-content" onclick="mapClick();" style="height: 98%; width: 15%">
                        <div style="height: 100%; float: left; width: 30%; display:table-cell; vertical-align:central; text-align:center; padding-top: 18px;">
                            <img alt="" src="~/Content/Images/loading-process.png" height="20" width="20">
                        </div>

                        <div style="height: 100%; float: left; width: 70%;">
                            <p style="color: white; vertical-align:top; font-size: 20px; padding-left: 55px;">50</p>
                            <p style="color: white; font-size: 12px; padding-left: 22px;"> Hoạt động</p>
                        </div>
                    </div>
                    <div id="right" style="height: 98%; width: 15%">
                        <div style="height: 100%; float: left; width: 30%; display:table-cell; vertical-align:central; text-align:center; padding-top: 18px;">
                            <img alt="" src="~/Content/Images/support.png" height="20" width="20">
                        </div>

                        <div style="height: 100%; float: left; width: 70%;">
                            <p style="color: white; vertical-align:top; font-size: 20px; padding-left: 55px;">3</p>
                            <p style="color: white; font-size: 12px; padding-left: 22px;">Trợ giúp</p>
                        </div>
                    </div>

                </div>
                <div style="height: 2%;">
                </div>
                <div id="primary-div" style="height: 87%;background-color: white; border: 1px solid #EAEBED; border-radius: 3px;">
                    @{
                        var item = Model;
                        if (item.OptionRenderView == 1)
                        {
                            Html.RenderPartial("Map", Model);
                        }
                        if (item.OptionRenderView == 2)
                        {
                            Html.RenderPartial("Message", Model);
                        }
                    }

                </div>

            </div>
        </div>
    </div>

    <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <div class="modal-header">
                <span class="closepopup">×</span>
                <h4>CẢNH BÁO</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="comment">Tin nhắn:</label>
                    <textarea class="form-control" style="resize: none;" rows="4" id="comment"></textarea>
                    <button style="margin-top: 8px;" class="btn">Gửi Cảnh Báo </button>
                </div>
            </div>
        </div>
    </div>
    <style>
        .mini-stat > a {
            text-decoration: none;
        }

        .mini-stat {
            text-align: center;
        }

            .mini-stat img {
                margin: 0 auto;
                text-align: center;
            }

        .mini-stat-info span {
            color: #1FB5AD;
            font-size: 16px;
            padding-top: 17px;
            text-align: center;
        }

        .mini-stat-info a {
            text-decoration: none;
        }

        .mini-stat .hvr-glow:hover, .hvr-glow:focus, .hvr-glow:active {
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
            border-radius: 50%;
        }

        .mini-stat .hvr-glow {
            border-radius: 50%;
        }
    </style>
</div>
<script>
        var marker, map;
        var listMarker = new Array();
        var longfake = 0.0000000001;
        var lagfake = 0.0000000001
        var listPosition = [];
        var listInforwindow = [];

        var pinColor = "FE7569";
        var pinColorSelect = "1FB5AD"

        var pinImage = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + pinColor,
            new google.maps.Size(21, 34),
            new google.maps.Point(0, 0),
            new google.maps.Point(10, 34));

        var pinImageSelect = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + pinColorSelect,
            new google.maps.Size(21, 34),
            new google.maps.Point(0, 0),
            new google.maps.Point(10, 34));

        function initialize() {
            var myLatlng = new google.maps.LatLng(10.824638, 106.627733);
            var mapOptions = {
                zoom: 4,
                center: myLatlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            }
            map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
            google.maps.event.addListener(marker, 'click', function () {
                infowindow.open(map, marker);
            });
        }

        $(function () {
            initialize();
            google.maps.event.addListener(map, 'click', function (event) {
                var duration = parseInt($('#durationOption').val());

                if (duration < 0) {
                    duration = 1;
                    $('#durationOption').val(duration);
                }
                marker.setDuration(duration);
                marker.setEasing($('#easingOption').val());
                marker.setPosition(event.latLng);
            });

        });

        $(document).ready(function () {
            $('#DemoAjaxClick').click(function () {
                setInterval(function () {
                    $.ajax({
                        url: "/Home/GetLocationTourGuide/20",
                        type: "GET",
                        dataType: 'json',
                        contentType: 'application/json; charset=utf-8',
                        async: true,
                        processData: false,
                        cache: false,
                        success: function (result) {
                            var results = $.parseJSON(result);
                            $(results).each(function (index, value) {

                                var longitude = this['longitude'];
                                var laitude = this['latitude'];
                                var currentLocation = new google.maps.LatLng(laitude, longitude);
                                MoverMarker(currentLocation, index)
                            });
                        },
                        error: function (xhr) {
                            alert('error');
                        }
                    });
                }, 2000)
            });
            $("#Search").click(function () {
                var bla = $('#nametour').val();
                $.ajax({
                    url: "/Home/SearchTourGuide/" + bla,
                    type: "GET",
                })
                .done(function (partialViewResult) {
                    $("#list-tour").html(partialViewResult);
                });
            });
        });

        function LoadMarker() {
            $.ajax({
                url: "/Home/CreateMarker/20",
                type: "GET",
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                async: true,
                processData: false,
                cache: false,
                success: function (result) {
                    var results = $.parseJSON(result);
                    $(results).each(function (index, value) {
                        var longitude = this['longitude'];
                        var laitude = this['latitude'];
                        var title = " " + this['tour_guide_id'];
                        var currentLocation = new google.maps.LatLng(laitude, longitude);
                        createMarker(index, currentLocation, title);
                    });
                },
                error: function (xhr) {
                    alert('error');
                }
            });
        }

        function MoverMarker(Latlng, index) {
            var duration = parseInt($('#durationOption').val());
            if (duration < 0) {
                duration = 1;
                $('#durationOption').val(duration);
            }
            listMarker[index].setDuration(duration);
            listMarker[index].setEasing($('#easingOption').val());
            listMarker[index].setPosition(Latlng);
        }

        function createMarker(index, latlng, title) {

            window.setTimeout(function () {
                listMarker[index] = new SlidingMarker({
                    position: latlng,
                    map: map,
                    animation: google.maps.Animation.Gp,
                    icon: pinImage,
                    //shadow: pinShadow
                })
                listInforwindow[index] = new google.maps.InfoWindow({
                    content: title
                });
                listInforwindow[index].open(map, listMarker[index]);
            }, 200);
        }
        function getMarkerSelected(id) {
            $.ajax({
                url: "/Home/GetLocationMarkerSelected/" + id,
                type: "GET",
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                async: true,
                processData: false,
                cache: false,
                success: function (result) {
                    var results = $.parseJSON(result);
                    $(results).each(function (index, value) {

                        var longitude = this['longitude'];
                        var laitude = this['latitude'];
                        var location = new google.maps.LatLng(laitude, longitude);
                        panTo(laitude, longitude);

                        for (i = 0 ; i < listMarker.length; i++) {

                            listMarker[i].setIcon(pinImage);

                        }
                        listMarker[id - 1].setIcon(pinImageSelect);

                    });
                },
                error: function (xhr) {
                    alert('error');
                }
            });
        }
        var panPath = [];
        var panQueue = [];
        var STEPS = 50;
        function panTo(newLat, newLng) {
            if (panPath.length > 0) {
                panQueue.push([newLat, newLng]);
            } else {

                panPath.push("LAZY SYNCRONIZED LOCK");
                var curLat = map.getCenter().lat();
                var curLng = map.getCenter().lng();
                var dLat = (newLat - curLat) / STEPS;
                var dLng = (newLng - curLng) / STEPS;

                for (var i = 0; i < STEPS; i++) {
                    panPath.push([curLat + dLat * i, curLng + dLng * i]);
                }
                panPath.push([newLat, newLng]);
                panPath.shift();
                setTimeout(doPan, 20);
            }
        }

        function doPan() {
            var next = panPath.shift();
            if (next != null) {
                map.panTo(new google.maps.LatLng(next[0], next[1]));
                setTimeout(doPan, 20);
            } else {

                var queued = panQueue.shift();
                if (queued != null) {
                    panTo(queued[0], queued[1]);
                }
            }
        }
        function messageClick()
        {
            var bla = 2;
            $.ajax({
                url: "/Home/RenderHomeOption/" + bla,
                    type: "GET",
                })
                .done(function (partialViewResult) {
                    $("#primary-div").html(partialViewResult);
            });
        }
        function mapClick() {
            var bla = 1;
            $.ajax({
                url: "/Home/RenderHomeOption/" + bla,
                type: "GET",
            })
                .done(function (partialViewResult) {
                    $("#primary-div").html(partialViewResult);
                });
        }
        // For POPUP
        var modal = document.getElementById('myModal');
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("closepopup")[0];

        // When the user clicks the button, open the modal
        btn.onclick = function () {
            modal.style.display = "block";
        }
        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        function showPopup()
        {
            modal.style.display = "block";
        }
</script>
